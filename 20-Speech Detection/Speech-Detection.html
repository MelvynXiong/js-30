<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Speech Detection</title>
    <style>
        html {
            font-size: 10px;
        }
        body {
            font-size: 20px;
            font-weight: 200;
            font-family: "helvetica neue";
            background: #ffc600;
        }
        .words {
            position: relative;
            max-width: 500px;
            margin: 50px auto;
            padding: 1rem 2rem 1rem 5rem;
            line-height: 3rem;
            border-radius: 5px;
            box-shadow: 10px 10px 0 rgba(0,0,0,0.1);
            background: #fff;
            /*æ³¨æ„0 4 æ˜¯positionçš„çš„å€¼*/
            background: -webkit-gradient(linear, 0 0, 0 100%, from(#d9eaf3), color-stop(4%, #fff)) 0 4px;
            background-size: 100% 3rem;
        }
        p {
            margin: 0 0 3rem 0;
        }
        .words:before {
            content: '';
            position: absolute;
            top: 0;
            left: 30px;
            bottom: 0;
            border: 1px solid;
            border-color: transparent #e4e4e4;
            width: 4px;
        }
    </style>
</head>
<body>
    <div class="words" contenteditable="true"></div>
    <script>
        //æ ¹æ®æµè§ˆå™¨é—´çš„å…¼å®¹æ€§ï¼Œéœ€è¦åŒæ—¶æ·»åŠ å‰ç¼€
        window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        //å®ä¾‹åŒ–SpeechRecognitionå¯¹è±¡
        const recognition = new SpeechRecognition();
        // interimResults å±æ€§çš„é»˜è®¤å€¼æ˜¯ false ï¼Œ
        // ä»£è¡¨è¯­éŸ³è¯†åˆ«å™¨çš„è¿”å›å€¼ä¸ä¼šæ”¹å˜ã€‚
        // åœ¨è¿™ä¸ªæ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬æŠŠå®ƒè®¾ç½®ä¸º true ï¼Œ
        // è¿™æ ·éšç€æˆ‘ä»¬çš„è¾“å…¥ï¼Œè¯†åˆ«ç»“æœæœ‰å¯èƒ½ä¼šæ”¹å˜ã€‚
        // ä»”ç»†è§‚çœ‹æ¼”ç¤ºï¼Œç°è‰²çš„æ–‡å­—æ˜¯ä¸´æ—¶æ€§çš„ï¼Œæœ‰æ—¶ä¼šæ”¹å˜ï¼Œè€Œé»‘è‰²æ–‡æœ¬æ˜¯æœ€ç»ˆç»“æœï¼Œä¸ä¼šæ”¹å˜ã€‚
        recognition.interimResults = true;
        //è®¾ç½®è¯†åˆ«çš„è¯­è¨€
        recognition.lang = 'en-US';
        //åˆ›å»º<p>ï¼Œæ·»åŠ åˆ°DOM tree
        let p = document.createElement('p');
        const words = document.querySelector('.words');
        words.appendChild(p);

        console.log(recognition);
        //ç›‘å¬recognitionçš„resultäº‹ä»¶ï¼Œè·å–åˆ°è¯­éŸ³è¾“å…¥çš„æ–‡å­—

        recognition.addEventListener('result', (e) => {
            const text = Array.from(e.results)
            // e.resultsä¸­ä¿å­˜çš„æ˜¯è¯†åˆ«çš„ç»“æœï¼Œæœ¬æ¥å¹¶ä¸æ˜¯æ•°ç»„ï¼Œ
            // éœ€è¦å°†å…¶è½¬æ¢ä¸ºæ•°ç»„ï¼Œæ–¹ä¾¿ä½¿ç”¨å…¶mapã€joinç­‰æ–¹æ³•ã€‚
                .map(result => result[0]).map(result => result.transcript).join('');
            //const text = results.replace(/goog/gi, 'ğŸ‘Œ')ï¼›
            console.log(e);
            console.log(e.results);
            console.log(e.results[0]);
            console.log(e.results[0][0]);
            p.textContent = text;

            //å¦‚æœå½“å‰ä¸€æ®µè¾“å…¥ç»“æŸäº†ï¼Œä¹Ÿå°±æ˜¯æœ‰äº†åœé¡¿ï¼Œå°±ä¼šæ–°å»ºä¸€ä¸ªpæ ‡ç­¾
            if(e.results[0].isFinal) {
                p = document.createElement('p');
                words.appendChild(p);
            }
        });
        // ç›‘å¬recognitionçš„endäº‹ä»¶ï¼Œå½“å‰è¾“å…¥ç»“æŸåï¼Œ
        // å†æ¬¡å¼€å§‹ï¼Œä½¿å…¶ä¸€ç›´å¤„äºè¾“å…¥çŠ¶æ€
        recognition.addEventListener('end', recognition.start);
        //å¼€å¯recognition
        recognition.start();
        //æ•°æ®ç»“æ„
        // {
        //
        //     results: {
        //         0: {
        //             0: {
        //                 confidence: 0.695017397403717,
        //                     transcript: "ä½ å¥½ï¼Œä¸–ç•Œ"
        //             },
        //             isFinal:true,
        //                 length:1
        //         },
        //         length:1
        //     },
        // }
    </script>
</body>
</html>